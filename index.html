<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>SAHASARARAA</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<style>
:root{--primary:#8b0000;--muted:#666}
body{font-family:Inter,Arial,Helvetica,sans-serif;margin:0;background:#fff;color:#111}
header{background:var(--primary);color:#fff;padding:12px 18px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:1000;transition:0.3s}
header h1{margin:0;font-size:20px}
a{color:inherit;text-decoration:none}
.container{max-width:1100px;margin:18px auto;padding:0 12px}
.grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
.card{border:1px solid #eee;border-radius:8px;padding:10px;background:#fafafa}
img{max-width:100%;border-radius:6px}
.btn{background:var(--primary);color:#fff;border:none;padding:8px 10px;border-radius:6px;cursor:pointer;transition:0.2s}
.btn:hover{opacity:0.95}
input,select,textarea{padding:8px;border-radius:6px;border:1px solid #ddd;width:100%;box-sizing:border-box;margin:6px 0}
.muted{color:var(--muted)}
.flex{display:flex;gap:8px;align-items:center}

/* Hamburger Menu */
.menu-btn{display:none;flex-direction:column;gap:4px;cursor:pointer;z-index:1100}
.menu-btn div{width:25px;height:3px;background:#fff;transition:0.3s}
.nav-links{display:flex;gap:12px;align-items:center;transition:all 0.3s ease}
.nav-links a{color:#fff}
.nav-links.show{display:flex;flex-direction:column;position:absolute;top:60px;left:0;width:100%;background:var(--primary);padding:12px;gap:10px;box-shadow:0 4px 8px rgba(0,0,0,0.2);transform:translateY(-20px);opacity:0;animation:slideDown 0.25s forwards}
@keyframes slideDown{to{transform:translateY(0);opacity:1}}
@media (max-width:768px){
  .nav-links{display:none}
  .menu-btn{display:flex}
}
#hero{background:#f8f8f8;padding:40px 12px;text-align:center;margin-bottom:12px;border-radius:8px}
#hero h2{margin:0;font-size:28px;margin-bottom:12px}
#hero button{margin-top:12px}
.search-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.panel{padding:12px;border-radius:8px;background:#fff;border:1px solid #eee;margin-bottom:12px}
.small-muted{color:var(--muted);font-size:13px}
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;gap:12px">
    <img src="/images/SASRS_logo.png" alt="Sahasrara Logo" style="height:50px;">
    <h1>SAHASARARAA</h1>
  </div>

  <div style="display:flex;align-items:center;gap:12px">
    <div class="menu-btn" id="menu-toggle" title="Menu">
      <div></div><div></div><div></div>
    </div>
    <nav class="nav-links" id="nav-links">
      <span id="header-welcome" style="font-size:14px"></span>
      <a href="#" id="link-home">Home</a>
      <a href="#" id="link-products-nav">Products</a>
      <a href="#" id="link-cart">Cart (<span id="cart-count">0</span>)</a>
      <a href="#" id="link-orders">Orders</a>
      <a href="/login.html" id="link-auth">Login/Register</a>
      <a href="/about.html">About</a>
      <a href="/admin.html">Admin</a>
    </nav>
  </div>
</header>

<!-- Hero -->
<div id="hero">
  <img src="/images/SASRS_logo.png" alt="SAHASARARAA Logo" style="height:140px;margin-bottom:10px"/>
  <h2>Welcome to SAHASARARAA</h2>
  <p class="small-muted">Authentic sarees — traditional weaves, modern styles.</p>
  <button class="btn" id="btn-shop">Shop Now</button>
</div>

<!-- Main root where your app renders -->
<div id="root" class="container" style="display:none;"></div>

<script>
/* --- minimal app state + menu controls --- */
const API = '/api';
window.appState = { token: localStorage.getItem('token'), user: localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')) : null };

function setAuth(token, user){
  if (token) localStorage.setItem('token', token); else localStorage.removeItem('token');
  if (user) localStorage.setItem('user', JSON.stringify(user)); else localStorage.removeItem('user');
  window.appState.token = token;
  window.appState.user = user;
  updateHeader();
}
function updateHeader(){
  const welcome = document.getElementById('header-welcome');
  const auth = document.getElementById('link-auth');
  if (window.appState.user) {
    welcome.textContent = 'Hi, ' + window.appState.user.name;
    auth.textContent = 'Logout';
    auth.href = '#';
  } else {
    welcome.textContent = '';
    auth.textContent = 'Login/Register';
    auth.href = '/login.html';
  }
  fetchCartCount();
}

/* menu toggle */
const menuToggle = document.getElementById('menu-toggle');
const navLinks = document.getElementById('nav-links');
menuToggle.addEventListener('click', ()=>{
  navLinks.classList.toggle('show');
});

/* hero -> shop */
document.getElementById('btn-shop').addEventListener('click', ()=>{
  document.getElementById('hero').style.display='none';
  document.getElementById('root').style.display='block';
  renderApp();
});

/* nav link handlers */
document.getElementById('link-home').addEventListener('click', (ev)=>{ ev.preventDefault(); document.getElementById('hero').style.display='block'; document.getElementById('root').style.display='none'; });
document.getElementById('link-products-nav').addEventListener('click', (ev)=>{ ev.preventDefault(); document.getElementById('hero').style.display='none'; document.getElementById('root').style.display='block'; renderApp(); });
document.getElementById('link-cart').addEventListener('click', (ev)=>{ ev.preventDefault(); renderCart(); });
document.getElementById('link-orders').addEventListener('click', (ev)=>{ ev.preventDefault(); renderOrders(); });
document.getElementById('link-auth').addEventListener('click', (ev)=>{ 
  ev.preventDefault();
  if (window.appState.user) { setAuth(null,null); alert('Logged out'); renderApp(); } 
  else window.location = '/login.html';
});

/* cart count */
function fetchCartCount(){
  const el = document.getElementById('cart-count');
  if (!window.appState.token){ el.textContent = '0'; return; }
  fetch(API + '/cart', { headers: { 'Authorization': 'Bearer ' + window.appState.token } })
    .then(r=>r.json()).then(data => {
      const n = data.items ? data.items.reduce((s,i)=>s+i.qty,0) : 0;
      el.textContent = n;
    }).catch(()=>el.textContent='0');
}

/* ---------------------------------------------------------------------------
   The following JS block is your existing app logic (renderApp, loadProducts,
   viewProduct, addToCart, buyNow, renderCart, renderCheckout, renderOrders, renderAuth)
   Keeps same API calls as your backend.
   --------------------------------------------------------------------------- */

function renderApp(){
  const container = document.getElementById('root');
  container.innerHTML = '<div class="panel"><div class="search-row"><input id="search" placeholder="Search sarees"/><select id="cat"><option value="">All</option><option>Silk</option><option>Pattu</option><option>Banarasi</option><option>Cotton</option></select><button class="btn" id="btn-search">Search</button></div></div><h2>Collections</h2><div id="list" style="margin-top:12px" class="grid"></div>';
  document.getElementById('btn-search').addEventListener('click', loadProducts);
  loadProducts();
}

function loadProducts(){
  const q = document.getElementById('search') ? document.getElementById('search').value : '';
  const cat = document.getElementById('cat') ? document.getElementById('cat').value : '';
  let url = API + '/products';
  const params = [];
  if (q) params.push('q=' + encodeURIComponent(q));
  if (cat) params.push('category=' + encodeURIComponent(cat));
  if (params.length) url += '?' + params.join('&');
  fetch(url).then(r=>r.json()).then(list=>{
    const wrap = document.getElementById('list'); if(!wrap) return;
    wrap.innerHTML = '';
    list.forEach(p=>{
      const card = document.createElement('div'); card.className='card';
      card.innerHTML = `
        <img src="${(p.images && p.images[0]) ? p.images[0] : 'https://via.placeholder.com/500x350?text=' + encodeURIComponent(p.name)}" />
        <h3>${p.name}</h3>
        <div class="muted">₹${p.price}</div>
        <div class="muted small">${p.desc || ''}</div>
        <div style="margin-top:8px" class="flex">
          <button class="btn" onclick="viewProduct('${p.id}')">View</button>
          <button class="btn" onclick="addToCart('${p.id}',1)" style="background:#333">Add to Cart</button>
        </div>
      `;
      wrap.appendChild(card);
    });
  });
}

window.viewProduct = function(id){
  fetch(API + '/products/' + id).then(r=>r.json()).then(p=>{
    const root = document.getElementById('root');
    root.innerHTML = '<div style="display:flex;gap:12px;flex-wrap:wrap"><div style="flex:1;min-width:280px"><img src="'+(p.images && p.images[0] ? p.images[0] : 'https://via.placeholder.com/600x600')+'" style="width:100%;height:auto;border-radius:6px"/></div><div style="flex:1;min-width:280px"><h2>'+p.name+'</h2><div class="muted">₹'+p.price+'</div><p>'+ (p.desc||'') +'</p><div class="muted">Category: '+p.category+' | Color: '+p.color+'</div><div style="margin-top:12px"><button class="btn" onclick="addToCart(\\''+p.id+'\\',1)">Add to Cart</button><button class="btn" onclick="buyNow(\\''+p.id+'\\')">Buy Now</button></div></div></div>';
  });
};

window.addToCart = function(productId, qty){
  if (!window.appState.token){ alert('Please login/register'); window.location = '/login.html'; return; }
  fetch(API + '/cart', { method:'POST', headers: { 'Content-Type':'application/json','Authorization':'Bearer ' + window.appState.token }, body: JSON.stringify({ productId, qty }) })
    .then(r=>r.json()).then(res=>{ alert(res.message || 'Added'); fetchCartCount(); }).catch(()=>alert('Error'));
};

window.buyNow = function(productId){
  if (!window.appState.token){ alert('Please login/register'); window.location = '/login.html'; return; }
  fetch(API + '/cart', { method:'POST', headers:{ 'Content-Type':'application/json','Authorization':'Bearer ' + window.appState.token }, body: JSON.stringify({ productId, qty:1 }) })
    .then(()=> renderCart());
};

function renderCart(){
  if (!window.appState.token){ alert('Please login/register'); window.location = '/login.html'; return; }
  fetch(API + '/cart', { headers: { 'Authorization': 'Bearer ' + window.appState.token } })
    .then(r=>r.json()).then(data=>{
      const root = document.getElementById('root');
      let html = '<h2>Your Cart</h2>';
      if (!data.items || data.items.length===0) { root.innerHTML = html + '<div class="panel">Cart empty</div>'; return; }
      html += '<div class="panel">';
      let total = 0;
      data.items.forEach(it => {
        const p = it.product || {};
        const sub = (p.price||0) * it.qty; total += sub;
        html += '<div style="display:flex;gap:12px;align-items:center;margin-bottom:8px"><div style="flex:1"><b>'+ (p.name||'') +'</b><div class="muted">₹'+(p.price||0)+'</div></div><div>Qty: '+it.qty+'</div><div><button class="btn" onclick="removeCart(\\''+(p.id||'')+'\\')">Remove</button></div></div>';
      });
      html += '<hr><div><b>Total: ₹'+total+'</b></div><div style="margin-top:8px"><button class="btn" onclick="renderCheckout()">Checkout (Cash on Delivery)</button></div></div>';
      root.innerHTML = html;
    });
}

window.removeCart = function(productId){
  fetch(API + '/cart/' + productId, { method:'DELETE', headers: { 'Authorization': 'Bearer ' + window.appState.token } })
    .then(r=>r.json()).then(res=>{ alert(res.message); renderCart(); fetchCartCount(); });
};

window.renderCheckout = function(){
  if (!window.appState.token){ alert('Please login/register'); window.location = '/login.html'; return; }
  const root = document.getElementById('root');
  root.innerHTML = '<h2>Checkout (Cash on Delivery)</h2><div class="panel"><input id="ship-name" placeholder="Name" value="'+(window.appState.user?window.appState.user.name:'')+'"/><input id="ship-mobile" placeholder="Mobile" value="'+(window.appState.user?window.appState.user.mobile:'')+'"/><input id="ship-address" placeholder="Address"/><input id="ship-city" placeholder="City"/><input id="ship-pincode" placeholder="Pincode"/><button class="btn" id="btn-place">Place Order</button></div>';
  document.getElementById('btn-place').addEventListener('click', ()=>{
    const shipping = {
      name: document.getElementById('ship-name').value.trim(),
      mobile: document.getElementById('ship-mobile').value.trim(),
      address: document.getElementById('ship-address').value.trim(),
      city: document.getElementById('ship-city').value.trim(),
      pincode: document.getElementById('ship-pincode').value.trim()
    };
    if (!shipping.name||!shipping.mobile||!shipping.address||!shipping.city||!shipping.pincode) return alert('Please fill all fields');
    fetch(API + '/order', { method:'POST', headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + window.appState.token }, body: JSON.stringify({ shipping }) })
      .then(r=>r.json()).then(res=>{ if (res.order) { alert('Order placed: ' + res.order.id); renderOrders(); fetchCartCount(); } else alert(res.message || 'Error'); });
  });
};

function renderOrders(){
  if (!window.appState.token){ alert('Please login/register'); window.location = '/login.html'; return; }
  fetch(API + '/orders', { headers: { 'Authorization': 'Bearer ' + window.appState.token } })
    .then(r=>r.json()).then(list=>{
      const root = document.getElementById('root');
      let html = '<h2>Your Orders</h2><div class="panel">';
      if (!list || list.length===0) html += 'No orders yet';
      else {
        list.forEach(o=>{
          html += '<div style="border-bottom:1px dashed #ddd;padding:8px 0"><b>Order: '+o.id+'</b><div class="muted">Placed: '+ new Date(o.createdAt).toLocaleString() +'</div><div>Total: ₹'+o.totalAmount+'</div><div>Payment: '+o.paymentMode+' | Status: '+o.orderStatus+'</div><div class="muted">Ship to: '+o.shipping.name+', '+o.shipping.address+', '+o.shipping.city+' - '+o.shipping.pincode+'</div></div>';
        });
      }
      html += '</div>';
      root.innerHTML = html;
    });
}

function renderAuth(){
  window.location = '/login.html';
}

/* init */
updateHeader();
document.getElementById('root').style.display = 'none'; // show hero first
</script>

</body>
</html>
